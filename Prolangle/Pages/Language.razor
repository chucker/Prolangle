@page "/Language"
@using Prolangle.Services
@using Prolangle.Components
@using Prolangle.Languages.Framework

@inject GuessGame GuessGame
@inject LanguagesProvider LanguagesProvider

<h1>Guess a Language</h1>

@if (won)
{
    <h2>You won!</h2>
}
else
{
    <LanguageSelection AvailableLanguages="@AvailableLanguages" OnLanguageSelected="@OnLanguageSelected"/>
}

<table>
    <thead>
    <tr>
        <th>Language</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var language in RevealedLanguages)
    {
        <tr>
            <td>@language.Name</td>
        </tr>
    }
    </tbody>
</table>

@code {
    private List<ILanguage> AvailableLanguages => LanguagesProvider!.Languages.Where(l => !RevealedLanguages.Contains(l)).ToList();
    private List<ILanguage> RevealedLanguages { get; } = [];
    private bool won;

    private void OnLanguageSelected(ILanguage language)
    {
        RevealedLanguages.Add(language);

        var result = GuessGame!.Guess(language);

        if (result)
            won = true;
    }

}
